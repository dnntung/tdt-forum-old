<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link type="image/x-icon" rel="icon" href="data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAABGdBTUEAALGPC/xhBQAAAAFzUkdC
  AdnJLH8AAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAARpQTFRF
  AAAA/////////////////////////////////////////////f7+/f7+////////stHm////sdDl
  /v7/+/3+////1ObyYqPOXZ7KX6DLXJ7K//3999DL9L639sC5ppCeTXmkJ365CGmtUJbF1OXx+/3+
  5vD34+724/D459fZ4lpJ4VJB3EEu46CbRZLESZHD9Pj7wdrrLYG6Inu3IXy4hmN35FtK99XR7JaL
  5FRCsrLCE3Kzp8riaqXOBmmtbaHI2Kem87ev+d7a5GRV6Yh9c6nPRpDC7PP5/f7+ZKLMKYC72qqp
  5l9N411M4VZF4VVE9dHN5fH56fL4z+LvF3Kyf7LV+dTP8rav8rew8rmy99TQ//z8YqHL2ujzAyDg
  KQAAABV0Uk5TAAAHSafk+xiS7rEGkgZK7e3j7QaSbhp6TwAAAAFiS0dEAf8CLd4AAAAJcEhZcwAA
  CxMAAAsTAQCanBgAAAC2SURBVBjTZY/VEsJADEWzsGyLtRRY3N3d3d1d//83kGGAgfOUm4fkXABA
  IjGWECLBYhGCe0QMK6VPpCyDECBGRt/IGARyln6hUALHv2ad3mA0qTjAj2C2WG12h9Pl9mAQvD5/
  IBgKhyPRWDxBBSDJVDqTzeULxVK5QikB4qnW6o1mq93p9vqPhTAYjsaT6Wy+WK7u1wTA6812tz8c
  T+fnLwyc+nL9ePAcaLSDLzFW/q/+V+63/g1paRpfEB4PJAAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAy
  MS0wNS0xOFQwNzo0NzozMCswMDowMHByssQAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMjEtMDUtMThU
  MDc6NDc6MzArMDA6MDABLwp4AAAARnRFWHRzb2Z0d2FyZQBJbWFnZU1hZ2ljayA2LjcuOC05IDIw
  MTQtMDUtMTIgUTE2IGh0dHA6Ly93d3cuaW1hZ2VtYWdpY2sub3Jn3IbtAAAAABh0RVh0VGh1bWI6
  OkRvY3VtZW50OjpQYWdlcwAxp/+7LwAAABh0RVh0VGh1bWI6OkltYWdlOjpoZWlnaHQAMTkyDwBy
  hQAAABd0RVh0VGh1bWI6OkltYWdlOjpXaWR0aAAxOTLTrCEIAAAAGXRFWHRUaHVtYjo6TWltZXR5
  cGUAaW1hZ2UvcG5nP7JWTgAAABd0RVh0VGh1bWI6Ok1UaW1lADE2MjEzMjQwNTDoHDF2AAAAD3RF
  WHRUaHVtYjo6U2l6ZQAwQkKUoj7sAAAAVnRFWHRUaHVtYjo6VVJJAGZpbGU6Ly8vbW50bG9nL2Zh
  dmljb25zLzIwMjEtMDUtMTgvNjdiM2MxZWMzY2RhNTQwODgwYmI5MGU2NjJjNDcxMmYuaWNvLnBu
  Z+QQzhgAAAAASUVORK5CYII=">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
  <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous"/>
  <link rel="stylesheet" href="/css/style.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js" integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA==" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
  
  <title>Trang chủ - TDT Forum</title>
</head>
<body>
  <nav class="navbar navbar-expand-sm navbar-light bg-light fixed-top shadow-sm">
    <div class="container-fluid">
      <a class="navbar-brand" href="/home">
        <img src="/images/tdt-logo.png" alt="TDT-Forum">
      </a>
      <div class="d-flex flex-row order-sm-last">
        <!-- Navbar profile toggler -->
        <button class="avatar avatar-profile rounded-circle navbar-toggler d-block" type="button" data-bs-toggle="dropdown">
          <img class="w-100 h-100" src="<%= currentUser.avatar %>" alt="<%= currentUser.nameTag %>">
        </button>
        <ul class="dropdown-menu dropdown-menu dropdown-menu-end">
          <li><a id="nameTag" href="/user/<%= currentUser.nameTag %>" class="dropdown-item"><strong>@<%= currentUser.nameTag %></strong></a></li>
          <li><hr class="dropdown-divider"></li>
          <% if (currentUser.role ===1) { %>
            <li><a href="" class="dropdown-item" data-bs-toggle="modal" data-bs-target="#createUserModal">Tạo tài khoản cho Phòng/Khoa</a></li>  
          <% } %>
          <% if (currentUser.role !==3) { %>
            <li><a href="" class="dropdown-item" data-bs-toggle="modal" data-bs-target="#changePasswordModal">Thay đổi mật khẩu</a></li>  
          <% } %>
          <li><a href="/user/logout" class="dropdown-item">Đăng xuất</a></li>
        </ul>
        <!-- Navbar menu toggler -->
        <button class="navbar-menu navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMenu" aria-controls="navbarSupportedContent" aria-expanded="false">
          <span class="navbar-toggler-icon"></span>
        </button>
      </div>
      <!-- Navbar menu -->
      <div class="collapse navbar-collapse mt-2 mt-sm-0" id="navbarMenu">
        <ul class="navbar-nav me-auto mb-lg-0">
          <li class="nav-item">
            <a href="/" class="nav-link text-dark" aria-current="page" href="#">
              <span class="icon"><i class="fas fa-home"></i></span>
              <span class="label">Trang chủ</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-dark" href="/notification">
              <span class="icon"><i class="fas fa-bell"></i></span>
              <span class="label">Thông báo</span>
            </a>
          </li>
      </div>
    </div>
  </nav>

  <div class="body container-md px-3">
    <div class="row position-relative pb-3">
      <div class="col-md-2"></div>
      <div id="posts" class="col-md-8">
        <div class="pb-0 bg-light shadow-sm rounded">
          <!-- Khu vực chính -->
          <div class="content">
            <div class="post pt-3 px-3 border-bottom " data-id="<%= selectedPost._id %>">
              <div class="post-container w-100 d-flex flex-row">
                <div class="post-header avatar rounded-circle pr-3 shadow">
                  <img class="w-100 h-100" src="<%= selectedPost.poster.avatar %>" alt="<%= selectedPost.poster.nameTag %>">
                </div>
                <div class="w-100">
                  <div class="post-header w-100 d-flex justify-content-between">
                    <div class="poster d-flex flex-column">
                      <a href="/user/<%= selectedPost.poster.nameTag %>" class="name text-decoration-none"><strong><%= selectedPost.poster.name %></strong></a>
                      <div class="text-muted">
                        <small class="name-tag">@<%= selectedPost.poster.nameTag %></small>
                        <span> - </span>
                        <small class="date-created"><%= `${selectedPost.dateCreated.getDate()}/${selectedPost.dateCreated.getMonth()+1}/${selectedPost.dateCreated.getFullYear()}` %></small>
                      </div>
                    </div>
                    <% if (selectedPost.poster.nameTag === currentUser.nameTag) { %>
                      <div class="post-options">
                        <button class="rounded btn" data-bs-toggle="dropdown">  
                          <span><i class="fas fa-ellipsis-h"></i></span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu dropdown-menu-end">
                          <li>
                            <button class="dropdown-item editPostBtn" data-bs-toggle="modal" data-bs-target="#editPostModal">
                              <span><i class="fas fa-pen"></i></span>
                              <span class="label">Chỉnh sửa bài viết</span>
                            </button>
                          </li>  
                          <li>
                            <button class="dropdown-item deletePostBtn" data-bs-toggle="modal" data-bs-target="#deletePostModal>
                              <span><i class="fas fa-trash-alt"></i></span>
                              <span class="label">Xóa bài viết</span>
                            </button>
                          </li>
                        </ul>
                      </div>
                    <% } %>
                  </div>
                  <div class="post-content">
                    <%- selectedPost.content.split("\n").join("<br/>") %>
                  </div>
                </div>
              </div>
              
              <% if (selectedPost.attachment) { %>
                <div class="post-attachment border rounded position-relative mt-3 video-wrapper">
                  <%- selectedPost.attachment.video?`<iframe width="560" height="315" src="https://www.youtube.com/embed/${selectedPost.attachment.video}"></iframe>`:'' %>
                  <%- selectedPost.attachment.image?`<img class="w-100" src="/images/posts/${selectedPost._id}_${selectedPost.attachment.image}">`:'' %>
                </div>
              <% } %>  
              
              <div class="post-bar d-flex pt-1">
                <button class="btn heart <%= hearted?'text-danger':''%>" data-hearted="false">
                  <span class="heart-state"><%- `<i class="fa${!hearted?'r':'s'} fa-heart"></i>`%></span>
                  <small class="heart-count label"><%= selectedPost.likes.length %></small>
                </button>
                <a href="#" class="btn comment">
                  <span><i class="far fa-comment-alt"></i></span>
                  <small class="label"><%= selectedPost.comments.length %> bình luận</small>
                </a>
              </div>
            </div>
            <div id="post-cmt" class="">
              <div id="uploadCmt" class="d-flex  p-3">
                <div class="flex-fill">
                  <span id="cmtContent" class="w-100 form-control " role="textbox" contenteditable="true"></span>
                </div>
                <button id="cmtBtn" class="btn btn-primary disabled" data-id="<%= selectedPost._id %>">
                  <span><i class="far fa-paper-plane"></i></span>
                </button>
              </div>
              <div>
                <div id="cmt-list">
                  <!-- <div class="cmt post p-3">
                    <div class="post-container w-100 d-flex flex-row">
                      <div class="post-header avatar rounded-circle pr-3 shadow">
                        <img class="w-100 h-100" src="${post.poster.avatar}" alt="${post.poster.nameTag}">
                      </div>
                      <div class="w-100">
                        <div class="post-header w-100 d-flex justify-content-between">
                          <div class="poster d-flex flex-column">
                            <a href="#" class="name text-decoration-none text-dark"><strong>Tung</strong></a>
                            <div class="text-muted">
                              <small class="name-tag">@demo</small>
                            </div>
                          </div>
                        </div>
                        <div class="post-content">
                          hi
                        </div>
                      </div>
                    </div>
                  </div> -->
                </div>
                <div class="loading text-center text-primary py-3">
                  <div class="spinner-border" role="status">
                    <span class="visually-hidden">Loading...</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div> 
      <div class="col-md-2"></div>
    </div>
  </div>

  <% if (selectedPost.poster.nameTag === currentUser.nameTag) { %>
    
  <% } %>

  <% if (currentUser.role !==3) { %>
    <div id="changePasswordModal" class="modal fade">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <div class="spinner-header mr-3">
              <div class="spinner-border ms-auto text-primary"></div>
            </div>
            <h5 class="modal-title"><strong>Thay đổi mật khẩu</strong></h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="currentPassword" class="form-label"><strong>Mật khẩu hiện tại</strong></label>
              <input type="password" id="currentPassword" class="form-control" placeholder="Nhập mật khẩu hiện tại">
            </div>
            <div class="mb-3">
              <label for="newPassword" class="form-label"><strong>Mật khẩu mới</strong></label>
              <input type="password" id="newPassword" rows="20" class="form-control" placeholder="Nhập mật khẩu mới">
            </div>
            <div>
              <label for="confirmNewPassword" class="form-label"><strong>Xác nhận mật khẩu mới</strong></label>
              <input type="password" id="confirmNewPassword" rows="20" class="form-control" placeholder="Nhập lại mật khẩu mới">
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" id="cancelChangePassword" class="form-control-btn btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
            <button id="confirmChangePassword" type="button" class="disabled form-control-btn btn btn-danger">Xác nhận</button>
          </div>
        </div>
      </div>
    </div>
  <% } %>
  <div id="deleteCmtModal" class="modal fade">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <div class="spinner-header mr-3">
            <div class="spinner-border ms-auto text-primary"></div>
          </div>
          <h5 class="modal-title"><strong>Xóa bình luận</strong></h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Bạn thực sự muốn xóa bình luận này?
        </div>
        <div class="modal-footer">
          <button type="button" class="form-control-btn btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
          <button id="confirmDeleteCmt" type="button" class="form-control-btn btn btn-danger">Xác nhận</button>
        </div>
      </div>
    </div>
  </div>

  <div id="editCmtModal" class="modal fade">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <div class="spinner-header mr-3">
            <div class="spinner-border ms-auto text-primary"></div>
          </div>
          <h5 class="modal-title"><strong>Chỉnh sửa bình luận</strong></h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="editCmtContent" class="form-label"><strong>Nội dung bình luận</strong></label>
            <span id="editCmtContent" class="w-100 form-control" role="textbox" contenteditable="true"></span>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="form-control-btn btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
          <button id="confirmEditCmt" type="button" class="form-control-btn btn btn-danger">Xác nhận</button>
        </div>
      </div>
    </div>
  </div>

  <% if (currentUser.role ===1) { %>
    <div id="createUserModal" class="modal fade">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <div class="spinner-header mr-3">
              <div class="spinner-border ms-auto text-primary"></div>
            </div>
            <h5 class="modal-title"><strong>Tạo tài khoản mới</strong></h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <input type="hidden" id='selectedTopics' value=''>
            <div class="row mb-3">
              <div class="col-md">
                <label for="username" class="form-label"><strong>Tên người dùng</strong></label>
                <input type="text" id="username" class="form-control" placeholder="Nhập tên người dùng">
              </div>
            </div>
            <div class="row ">
              <div class="col-md mb-3">
                <label for="password" class="form-label"><strong>Mật khẩu</strong></label>
                <input type="password" id="password" rows="20" class="form-control" placeholder="Nhập mật khẩu">
              </div>
              <div class="col-md mb-3">
                <label for="confirmPassword" class="form-label"><strong>Xác nhận mật khẩu</strong></label>
                <input type="password" id="confirmPassword" rows="20" class="form-control" placeholder="Nhập lại mật khẩu">
              </div>
            </div>
            <div class="row mb-3">
              <div class="mb-2"><strong>Người dùng có thể đăng bài ở 1 trong các chuyên mục:</strong></div>
              <div class="col-md">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="Phòng Công tác học sinh sinh viên (CTHSSV)">
                  <span class="form-check-label" >
                    Phòng Công tác học sinh sinh viên (CTHSSV)
                  </span>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="Phòng Đại học">
                  <span class="form-check-label" >
                    Phòng Đại học
                  </span>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="Phòng Sau đại học">
                  <span class="form-check-label" >
                    Phòng Sau đại học
                  </span>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="Phòng điện toán và máy tính">
                  <span class="form-check-label" >
                    Phòng điện toán và máy tính
                  </span>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="Phòng khảo thí và kiểm định chất lượng">
                  <span class="form-check-label" >
                    Phòng khảo thí và kiểm định chất lượng
                  </span>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="Phòng tài chính">
                  <span class="form-check-label" >
                    Phòng tài chính
                  </span>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="TDT Creative Language Center">
                  <span class="form-check-label" >
                    TDT Creative Language Center
                  </span>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="Trung tâm tin học">
                  <span class="form-check-label" >
                    Trung tâm tin học
                  </span>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="Trung tâm đào tạo phát triển xã hội (SDTC)">
                  <span class="form-check-label" >
                    Trung tâm đào tạo phát triển xã hội (SDTC)
                  </span>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="Trung tâm phát triển Khoa học quản lý và Ứng dụng công nghệ (ATEM)">
                  <span class="form-check-label" >
                    Trung tâm phát triển Khoa học quản lý và Ứng dụng công nghệ (ATEM)
                  </span>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="Trung tâm hợp tác doanh nghiệp và cựu sinh viên">
                  <span class="form-check-label" >
                    Trung tâm hợp tác doanh nghiệp và cựu sinh viên
                  </span>
                </div>
              </div>
              <div class="col-md">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="Khoa Luật">
                  <span class="form-check-label" >
                    Khoa Luật
                  </span>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="Trung tâm ngoại ngữ - tin học – bồi dưỡng văn hóa">
                  <span class="form-check-label" >
                    Trung tâm ngoại ngữ - tin học – bồi dưỡng văn hóa
                  </span>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="Viện chính sách kinh tế và kinh doanh">
                  <span class="form-check-label" >
                    Viện chính sách kinh tế và kinh doanh
                  </span>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="Khoa Mỹ thuật công nghiệp">
                  <span class="form-check-label" >
                    Khoa Mỹ thuật công nghiệp
                  </span>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="Khoa Điện – Điện tử">
                  <span class="form-check-label" >
                    Khoa Điện – Điện tử
                  </span>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="Khoa Công nghệ thông tin">
                  <span class="form-check-label" >
                    Khoa Công nghệ thông tin
                  </span>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="Khoa Quản trị kinh doanh">
                  <span class="form-check-label" >
                    Khoa Quản trị kinh doanh
                  </span>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="Khoa Môi trường và bảo hộ lao động">
                  <span class="form-check-label" >
                    Khoa Môi trường và bảo hộ lao động
                  </span>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="Khoa Lao động công đoàn">
                  <span class="form-check-label" >
                    Khoa Lao động công đoàn
                  </span>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="Khoa Tài chính ngân hàng">
                  <span class="form-check-label" >
                    Khoa Tài chính ngân hàng
                  </span>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="Trung tâm hợp tác doanh nghiệp và cựu sinh viên">
                  <span class="form-check-label" >
                    Khoa giáo dục quốc tế
                  </span>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" id="cancelCreateUser" class="form-control-btn btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
            <button id="confirmCreateUser" type="button" class="disabled form-control-btn btn btn-danger">Xác nhận</button>
          </div>
        </div>
      </div>
    </div>
  <% } %>
  

  <div class="modal" id="viewImageModal">
    <div class="modal-dialog modal-dialog-centered modal-xl d-flex justify-content-center">
      <img class="w-100">
    </div>
  </div>
  <div id="toasts" class="toast-container  position-fixed bottom-0 start-0 p-3">
  </div>

  <footer>
    <script src="/js/script.js"></script>
  </footer>
</body>
</html>